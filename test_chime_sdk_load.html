<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chime SDK Load Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        h1 {
            color: #00ff00;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border-left: 4px solid #00ff00;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .success {
            background: #1a3a1a;
            color: #00ff00;
        }
        .error {
            background: #3a1a1a;
            color: #ff0000;
        }
        .info {
            background: #1a1a3a;
            color: #5555ff;
        }
        .warning {
            background: #3a3a1a;
            color: #ffaa00;
        }
        pre {
            background: #0a0a0a;
            padding: 10px;
            overflow-x: auto;
            border-radius: 4px;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin: 5px;
        }
        button:hover {
            background: #00cc00;
        }
        #console-output {
            background: #0a0a0a;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #00ff00;
            margin-top: 20px;
        }
        .timestamp {
            color: #888;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>üß™ Chime SDK v3.19.0 Load Test</h1>

    <div class="test-section">
        <h2>Test Controls</h2>
        <button onclick="runAllTests()">‚ñ∂ Run All Tests</button>
        <button onclick="testSDKLoad()">Test SDK Load</button>
        <button onclick="testSDKClasses()">Test SDK Classes</button>
        <button onclick="testSDKInit()">Test SDK Initialization</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output"></div>
    </div>

    <!-- Load Chime SDK from CDN -->
    <script src="https://d2n29hdfurdqmu.cloudfront.net/chime-sdk-3.19.0.min.js"
            crossorigin="anonymous"
            onload="handleSDKLoaded()"
            onerror="handleSDKLoadError()"></script>

    <script>
        let testResults = [];
        let sdkLoaded = false;
        let sdkLoadStartTime = Date.now();

        // Console override to capture logs
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };

        function logToScreen(type, ...args) {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg =>
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');

            const div = document.createElement('div');
            div.innerHTML = `<span class="timestamp">[${timestamp}]</span> <span class="${type}">${type.toUpperCase()}:</span> ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;

            // Call original console method
            originalConsole[type](...args);
        }

        console.log = (...args) => logToScreen('log', ...args);
        console.error = (...args) => logToScreen('error', ...args);
        console.warn = (...args) => logToScreen('warn', ...args);
        console.info = (...args) => logToScreen('info', ...args);

        function addTestResult(name, success, message, details = null) {
            const result = {
                name,
                success,
                message,
                details,
                timestamp: new Date().toISOString()
            };
            testResults.push(result);

            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `
                <strong>${success ? '‚úÖ' : '‚ùå'} ${name}</strong><br>
                ${message}
                ${details ? `<pre>${JSON.stringify(details, null, 2)}</pre>` : ''}
            `;
            resultsDiv.appendChild(resultDiv);
        }

        function handleSDKLoaded() {
            sdkLoaded = true;
            const loadTime = Date.now() - sdkLoadStartTime;
            console.log(`‚úÖ Chime SDK loaded in ${loadTime}ms`);
            addTestResult(
                'SDK Load from CDN',
                true,
                `SDK loaded successfully in ${loadTime}ms`,
                { loadTime, url: 'https://d2n29hdfurdqmu.cloudfront.net/chime-sdk-3.19.0.min.js' }
            );
        }

        function handleSDKLoadError() {
            console.error('‚ùå Failed to load Chime SDK from CDN');
            addTestResult(
                'SDK Load from CDN',
                false,
                'Failed to load SDK - CDN might be blocked or unreachable'
            );
        }

        function testSDKLoad() {
            console.log('üß™ Testing SDK Load...');

            if (typeof window.ChimeSDK !== 'undefined') {
                console.log('‚úÖ window.ChimeSDK is defined');
                addTestResult('SDK Global Object', true, 'window.ChimeSDK exists');
                return true;
            } else {
                console.error('‚ùå window.ChimeSDK is undefined');
                addTestResult('SDK Global Object', false, 'window.ChimeSDK not found');
                return false;
            }
        }

        function testSDKClasses() {
            console.log('üß™ Testing SDK Classes...');

            if (!sdkLoaded) {
                addTestResult('SDK Classes', false, 'SDK not loaded yet');
                return false;
            }

            const requiredClasses = [
                'ConsoleLogger',
                'DefaultDeviceController',
                'DefaultMeetingSession',
                'MeetingSessionConfiguration',
                'DefaultActiveSpeakerPolicy',
                'VideoTileState',
                'AudioVideoObserver'
            ];

            const results = {};
            let allFound = true;

            for (const className of requiredClasses) {
                const exists = typeof window.ChimeSDK[className] !== 'undefined';
                results[className] = exists;

                if (exists) {
                    console.log(`‚úÖ ${className} found`);
                } else {
                    console.error(`‚ùå ${className} not found`);
                    allFound = false;
                }
            }

            addTestResult(
                'SDK Classes Verification',
                allFound,
                `${Object.values(results).filter(v => v).length}/${requiredClasses.length} classes found`,
                results
            );

            return allFound;
        }

        function testSDKInit() {
            console.log('üß™ Testing SDK Initialization...');

            if (!sdkLoaded) {
                addTestResult('SDK Initialization', false, 'SDK not loaded yet');
                return false;
            }

            try {
                // Test 1: Create ConsoleLogger
                const logger = new window.ChimeSDK.ConsoleLogger('TestLogger', window.ChimeSDK.LogLevel.INFO);
                console.log('‚úÖ ConsoleLogger created');

                // Test 2: Create DeviceController
                const deviceController = new window.ChimeSDK.DefaultDeviceController(logger);
                console.log('‚úÖ DefaultDeviceController created');

                // Test 3: Create MeetingSessionConfiguration (with mock data)
                const mockMeetingResponse = {
                    Meeting: {
                        MeetingId: 'test-meeting-123',
                        MediaRegion: 'us-east-1',
                        MediaPlacement: {
                            AudioHostUrl: 'https://test.example.com',
                            SignalingUrl: 'wss://test.example.com',
                            TurnControlUrl: 'https://test.example.com'
                        }
                    }
                };

                const mockAttendeeResponse = {
                    Attendee: {
                        AttendeeId: 'test-attendee-456',
                        JoinToken: 'test-token-789'
                    }
                };

                const configuration = new window.ChimeSDK.MeetingSessionConfiguration(
                    mockMeetingResponse,
                    mockAttendeeResponse
                );
                console.log('‚úÖ MeetingSessionConfiguration created');

                // Test 4: Create MeetingSession
                const meetingSession = new window.ChimeSDK.DefaultMeetingSession(
                    configuration,
                    logger,
                    deviceController
                );
                console.log('‚úÖ DefaultMeetingSession created');

                // Test 5: Check AudioVideoFacade
                const audioVideo = meetingSession.audioVideo;
                console.log('‚úÖ AudioVideoFacade accessible');

                // Test 6: Create ActiveSpeakerPolicy
                const activeSpeakerPolicy = new window.ChimeSDK.DefaultActiveSpeakerPolicy();
                console.log('‚úÖ DefaultActiveSpeakerPolicy created');

                addTestResult(
                    'SDK Initialization Test',
                    true,
                    'All SDK core objects initialized successfully',
                    {
                        logger: 'ConsoleLogger',
                        deviceController: 'DefaultDeviceController',
                        configuration: 'MeetingSessionConfiguration',
                        meetingSession: 'DefaultMeetingSession',
                        audioVideo: 'AudioVideoFacade',
                        activeSpeakerPolicy: 'DefaultActiveSpeakerPolicy'
                    }
                );

                return true;

            } catch (error) {
                console.error('‚ùå SDK Initialization failed:', error);
                addTestResult(
                    'SDK Initialization Test',
                    false,
                    `Failed to initialize SDK: ${error.message}`,
                    { error: error.toString(), stack: error.stack }
                );
                return false;
            }
        }

        function runAllTests() {
            console.log('üöÄ Running all tests...');
            clearConsole();
            document.getElementById('test-results').innerHTML = '';
            testResults = [];

            setTimeout(() => {
                const test1 = testSDKLoad();
                if (test1) {
                    setTimeout(() => {
                        const test2 = testSDKClasses();
                        if (test2) {
                            setTimeout(() => {
                                testSDKInit();
                                console.log('‚úÖ All tests completed!');
                            }, 500);
                        }
                    }, 500);
                }
            }, 100);
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
        }

        // Auto-run tests when SDK loads
        window.addEventListener('load', () => {
            console.log('Page loaded, waiting for SDK...');
            setTimeout(() => {
                if (sdkLoaded) {
                    console.log('SDK is ready! Click "Run All Tests" to begin.');
                } else {
                    console.warn('‚ö†Ô∏è SDK not loaded yet. Waiting...');
                    // Keep checking
                    const checkInterval = setInterval(() => {
                        if (sdkLoaded) {
                            console.log('SDK is now ready!');
                            clearInterval(checkInterval);
                        }
                    }, 1000);
                }
            }, 1000);
        });
    </script>
</body>
</html>
